"use strict";function showMessage(e,t){$("#fixedLog p").text(e).css({color:"#FFF",background:t}),$("#fixedLog").fadeIn("slow",function(){setTimeout(function(){$("#fixedLog").fadeOut("slow")},2e3)})}var serverAddress="localhost",serverPort=8080;$(function(){$("#iconsViewTrigger").on("click touchstart",function(e){e.preventDefault(),$("#iconsView").is(":hidden")&&($("#iconsView").fadeIn(0),$("#listView, #columnsView").fadeOut(0),$("#iconsViewTrigger").addClass("current"),$("#listViewTrigger, #columnsViewTrigger").removeClass("current"))}),$("#listViewTrigger").on("click touchstart",function(e){e.preventDefault(),$("#listView").is(":hidden")&&($("#listView").fadeIn(0),$("#iconsView, #columnsView").fadeOut(0),$("#listViewTrigger").addClass("current"),$("#iconsViewTrigger, #columnsViewTrigger").removeClass("current"))}),$("#columnsViewTrigger").on("click touchstart",function(e){e.preventDefault(),$("#columnsView").is(":hidden")&&($("#columnsView").fadeIn(0),$("#iconsView, #listView").fadeOut(0),$("#columnsViewTrigger").addClass("current"),$("#iconsViewTrigger, #listViewTrigger").removeClass("current"))}),$("#advancedFiltersMenuTrigger").on("click touchstart",function(e){e.preventDefault(),$("#advancedFiltersMenu").is(":hidden")&&$("#menus, #advancedFiltersMenu").fadeIn("slow")}),$("#configMenuTrigger").on("click touchstart",function(e){e.preventDefault(),$("#configMenu").is(":hidden")&&$("#menus, #configMenu").fadeIn("slow")}),$("#menusLeftover, #menusWrapper").on("click touchstart",function(e){!$("#infoMenu").is(":visible")||$(e.target).is("#infoMenu, #infoMenu *")&&!$(e.target).is(".closeButton")||(e.preventDefault(),$("#menus, #infoMenu").fadeOut("slow")),!$("#editMenu").is(":visible")||$(e.target).is("#editMenu, #editMenu *, #infoMenu button.actionButton")&&!$(e.target).is(".closeButton")||(e.preventDefault(),$("#menus, #editMenu").fadeOut("slow")),!$("#advancedFiltersMenu").is(":visible")||$(e.target).is("#advancedFiltersMenu, #advancedFiltersMenu *")&&!$(e.target).is(".closeButton")||(e.preventDefault(),$("#menus, #advancedFiltersMenu").fadeOut("slow")),!$("#configMenu").is(":visible")||$(e.target).is("#configMenu, #configMenu *")&&!$(e.target).is(".closeButton")||(e.preventDefault(),$("#menus, #configMenu").fadeOut("slow"))})}),$(function(){function e(){$.ajax({async:!0,crossDomain:!0,url:"http://"+serverAddress+":"+serverPort+"/printers/list",method:"GET",success:function(e,n){t(e),i()},error:function(e,t,i){i?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}})}function t(e){for(var t,i,n='<div id="iconsViewPopulation" class="wrapper">',a='<tbody id="listViewPopulation">',s='<div id="columnsViewPopulation" class="wrapper">',d=0;d<e.length;d++){if(t=r(),n+='<div id="'+t+'" class="printer',a+='<tr id="'+t+'" class="printer',s+='<div id="'+t+'" class="printer',e[d].detailedInfo.status)switch(e[d].detailedInfo.status.toLowerCase()){case"awake":n+=" connected",a+=" connected",s+=" connected",i="Awake";break;case"sleep":n+=" missing",a+=" missing",s+=" missing",i="Sleep";break;case"unreachable":n+=" missing",a+=" missing",s+=" missing",i="Unreachable";break;case"turn off":n+=" missing",a+=" missing",s+=" missing",i="Turn Off";break;case"with alerts":n+=" warning",a+=" warning",s+=" warning",i="With Alerts";break;case"busy with activities":n+=" connected",a+=" connected",s+=" connected",i="Busy With Activities";break;case"with system errors":n+=" error",a+=" error",s+=" error",i="With System Errors";break;case"not initialized":n+=" missing",a+=" missing",s+=" missing",i="Not Initialized";break;default:n+=" missing",a+=" missing",s+=" missing",i="Unknown"}else n+=" missing",a+=" missing",s+=" missing",i="Unknown";n+='" title="'+i+'">',a+='">',s+='" title="'+i+'">',n+='<div class="info">',s+='<div class="info">',e[d].basicInfo.ip?(n+="<p>"+e[d].basicInfo.ip.replace(/\s/g,"&nbsp;")+"</p>",a+="<td>"+e[d].basicInfo.ip+"</td>",s+="<p>"+e[d].basicInfo.ip.replace(/\s/g,"&nbsp;")+"</p>"):(n+="<p>&mdash;</p>",a+="<td>&mdash;</td>"),e[d].basicInfo.modelname?(n+="<p>"+e[d].basicInfo.modelname.replace(/\s/g,"&nbsp;")+"</p>",a+="<td>"+e[d].basicInfo.modelname+"</td>",s+="<p>"+e[d].basicInfo.modelname.replace(/\s/g,"&nbsp;")+"</p>"):(n+="<p>&mdash;</p>",a+="<td>&mdash;</td>"),e[d].detailedInfo.firmwareVersion?(n+="<p>"+e[d].detailedInfo.firmwareVersion.replace(/\s/g,"&nbsp;")+"</p>",a+="<td>"+e[d].detailedInfo.firmwareVersion+"</td>"):(n+="<p>&mdash;</p>",a+="<td>&mdash;</td>"),n+="</div>",s+="</div>",n+='<div class="state">',a+='<td class="state">'+i+"</td>",s+='<div class="state">',null!=e[d].metadata.reservedBy&&null!=e[d].metadata.reservedUntil&&(n+="<p>RESERVED</p>",s+="<p>R</p>"),a+=e[d].metadata.alias?"<td>"+e[d].metadata.alias+"</td>":"<td>&mdash;</td>",a+=e[d].metadata.reservedBy?"<td>"+e[d].metadata.reservedBy+"</td>":"<td>&mdash;</td>",n+="</div></div>",a+="</tr>",s+="</div></div>",o[t]=e[d]}n+="</div>",a+="</tbody>",s+="</div>",$("#iconsViewPopulation").remove(),$("#listViewPopulation").remove(),$("#columnsViewPopulation").remove(),$(n).appendTo("#iconsView"),$(a).appendTo("#listView table.wrapper"),$(s).appendTo("#columnsViewPrintersColumn")}function i(){$("#iconsViewPopulation div.printer, #listViewPopulation tr.printer").off().on("click touchstart",function(e){e.preventDefault();var t=n('<div id="infoMenuDetails" class="wrapper right">',o[e.currentTarget.id]),i=a('<div id="infoMenuInformation" class="wrapper right">',o[e.currentTarget.id]);$("#infoMenuDetails").remove(),$("#infoMenuInformation").remove(),$(t).appendTo("#infoMenuDetailsWrapper"),$(i).appendTo("#infoMenuInformationWrapper"),$("#infoMenu button.actionButton").attr("name",e.currentTarget.id),$("#infoMenu").is(":hidden")&&$("#menus, #infoMenu").fadeIn("slow")}),$("#columnsViewPopulation div.printer").off().on("click touchstart",function(e){e.preventDefault();var t=n('<div id="columnsViewPrinterDetails" class="wrapper right">',o[e.currentTarget.id]),i=a('<div id="columnsViewPrinterInformation" class="wrapper right">',o[e.currentTarget.id]);$("#columnsViewPrinterDetails").remove(),$("#columnsViewPrinterInformation").remove(),$(t).appendTo("#columnsViewPrinterDetailsWrapper"),$(i).appendTo("#columnsViewPrinterInformationWrapper"),$("#columnsViewPrinterDataColumn button.actionButton").attr("name",e.currentTarget.id),$("#columnsViewPrinterDataColumn *").fadeIn("slow")})}function n(e,t){if(e+=t.basicInfo.hostname?"<p>"+t.basicInfo.hostname.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",e+=t.basicInfo.ip?"<p>"+t.basicInfo.ip.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",e+=t.basicInfo.modelname?"<p>"+t.basicInfo.modelname.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",e+=t.detailedInfo.firmwareVersion?"<p>"+t.detailedInfo.firmwareVersion.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",t.detailedInfo.status){switch(e+='<p class="state',t.detailedInfo.status.toLowerCase()){case"awake":e+=" connected";break;case"sleep":e+=" missing";break;case"unreachable":e+=" missing";break;case"turn off":e+=" missing";break;case"with alerts":e+=" warning";break;case"busy with activities":e+=" connected";break;case"with system errors":e+=" error";break;case"not initialized":e+=" missing";break;default:e+=" missing"}e+='">'+t.detailedInfo.status.replace(/\s/g,"&nbsp;")+"</p>"}else e+='<p class="state missing">Unknown</p>';if(t.creationDate){var i=new Date(t.creationDate);e+="<p>"+("0"+i.getDate()).slice(-2)+"/"+("0"+(i.getMonth()+1)).slice(-2)+"/"+i.getFullYear()+" "+("0"+i.getHours()).slice(-2)+":"+("0"+i.getMinutes()).slice(-2)+":"+("0"+i.getSeconds()).slice(-2)+"</p>"}else e+="<p>&mdash;</p>";if(t.lastUpdate.status){var i=new Date(t.lastUpdate.status);e+="<p>"+("0"+i.getDate()).slice(-2)+"/"+("0"+(i.getMonth()+1)).slice(-2)+"/"+i.getFullYear()+" "+("0"+i.getHours()).slice(-2)+":"+("0"+i.getMinutes()).slice(-2)+":"+("0"+i.getSeconds()).slice(-2)+"</p>"}else e+="<p>&mdash;</p>";return e+="</div>"}function a(e,t){if(e+=t.metadata.alias?"<p>"+t.metadata.alias.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",e+=t.metadata.location?"<p>"+t.metadata.location.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",e+=t.metadata.workteam?"<p>"+t.metadata.workteam.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",e+=t.metadata.reservedBy?"<p>"+t.metadata.reservedBy.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",t.metadata.reservedUntil){var i=new Date(t.metadata.reservedUntil);e+="<p>"+("0"+i.getDate()).slice(-2)+"/"+("0"+(i.getMonth()+1)).slice(-2)+"/"+i.getFullYear()+" "+("0"+i.getHours()).slice(-2)+":"+("0"+i.getMinutes()).slice(-2)+":"+("0"+i.getSeconds()).slice(-2)+"</p>"}else e+="<p>&mdash;</p>";return e+="</div>"}function s(e){if(e.metadata.alias?$('#editForm input[name="alias"]').val(e.metadata.alias):$('#editForm input[name="alias"]').val(""),e.metadata.location?$('#editForm input[name="location"]').val(e.metadata.location):$('#editForm input[name="location"]').val(""),e.metadata.workteam?$('#editForm input[name="workteam"]').val(e.metadata.workteam):$('#editForm input[name="workteam"]').val(""),e.metadata.reservedBy?$('#editForm input[name="reservedBy"]').val(e.metadata.reservedBy):$('#editForm input[name="reservedBy"]').val(""),e.metadata.reservedUntil){var t=new Date(e.metadata.reservedUntil);$('#editForm input[name="reservedUntil"]').val(("0"+t.getDate()).slice(-2)+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+t.getFullYear()+" "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2))}else $('#editForm input[name="reservedUntil"]').val("")}function r(){var e,t,i="";for(e=0;e<32;e++)t=16*Math.random()|0,8!=e&&12!=e&&16!=e&&20!=e||(i+="-"),i+=(12==e?4:16==e?3&t|8:t).toString(16);return i}var o={},d={controlType:"select",oneLine:!0,timeInput:!0,dateFormat:"dd/mm/yy",timeFormat:"HH:mm:ss"};e(),$("#infoMenu button.actionButton, #columnsViewPrinterDataColumn button.actionButton").on("click touchstart",function(e){e.preventDefault();var t=n('<div id="editMenuDetails" class="wrapper right">',o[e.currentTarget.name]);$("#editMenuDetails").remove(),$(t).appendTo("#editMenuDetailsWrapper"),s(o[e.currentTarget.name]),$("#editForm input.datetimepicker").datetimepicker(d),$("#editMenu button.actionButton").attr("name",e.currentTarget.name),$("#editMenu").is(":hidden")&&($("#menus").is(":hidden")&&$("#menus").fadeIn("slow"),$("#infoMenu").is(":visible")&&$("#infoMenu").fadeOut(0),$("#editMenu").fadeIn("slow"))}),$("#editForm").on("submit",function(t){t.preventDefault();var i=$('#editForm input[name="reservedUntil"]').val().replace(/\s\s+/g," ").trim().split(/\/|\s|\:/),n=o[$("#editMenu button.actionButton").attr("name")],s={alias:$('#editForm input[name="alias"]').val().replace(/\s\s+/g," ").trim(),location:$('#editForm input[name="location"]').val().replace(/\s\s+/g," ").trim(),workteam:$('#editForm input[name="workteam"]').val().replace(/\s\s+/g," ").trim(),reservedBy:$('#editForm input[name="reservedBy"]').val().replace(/\s\s+/g," ").trim(),reservedUntil:new Date(i[2],i[1]-1,i[0],i[3],i[4],i[5]).getTime(),calendar:[]};$.ajax({async:!0,crossDomain:!0,url:"http://"+serverAddress+":"+serverPort+"/printers/update?ip="+n.basicInfo.ip+"&hostname="+n.basicInfo.hostname,method:"PUT",headers:{"Content-Type":"application/json"},processData:!1,data:JSON.stringify(s),success:function(t,i){showMessage("Information successfully updated","green"),o[$("#editMenu button.actionButton").attr("name")].metadata=s,$("#columnsViewPrinterInformation").remove(),$(a('<div id="columnsViewPrinterInformation" class="wrapper right">',o[$("#editMenu button.actionButton").attr("name")])).appendTo("#columnsViewPrinterInformationWrapper"),$("#columnsViewPrinterDataColumn *").fadeIn("slow"),e(),$("#menus, #editMenu").fadeOut("slow")},error:function(e,t,i){i?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}})})});