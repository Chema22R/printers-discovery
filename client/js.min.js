"use strict";function showMessage(e,n){$("#fixedLog p").text(e).css({color:"#FFF",background:n}),$("#fixedLog").fadeIn("slow",function(){setTimeout(function(){$("#fixedLog").fadeOut("slow")},2e3)})}var serverAddress="localhost",serverPort=8080,psOptions={minScrollbarLength:20},psInfoMenu=new PerfectScrollbar("#infoMenu",psOptions),psEditMenu=new PerfectScrollbar("#editMenu",psOptions),psAdvancedFiltersMenu=new PerfectScrollbar("#advancedFiltersMenu",psOptions),psConfigMenu=new PerfectScrollbar("#configMenu",psOptions),psColumnsViewPrinterDataColumn=new PerfectScrollbar("#columnsViewPrinterDataColumn",psOptions);$(function(){$("#iconsViewTrigger").on("click touchstart",function(e){e.preventDefault(),$("#iconsView").is(":hidden")&&($("#listView, #columnsView").fadeOut(0),$("#iconsView").fadeIn(0),$("#listViewTrigger, #columnsViewTrigger").removeClass("current"),$("#iconsViewTrigger").addClass("current"))}),$("#listViewTrigger").on("click touchstart",function(e){e.preventDefault(),$("#listView").is(":hidden")&&($("#iconsView, #columnsView").fadeOut(0),$("#listView").fadeIn(0),$("#iconsViewTrigger, #columnsViewTrigger").removeClass("current"),$("#listViewTrigger").addClass("current"))}),$("#columnsViewTrigger").on("click touchstart",function(e){e.preventDefault(),$("#columnsView").is(":hidden")&&($("#iconsView, #listView").fadeOut(0),$("#columnsView").fadeIn(0),$("#iconsViewTrigger, #listViewTrigger").removeClass("current"),$("#columnsViewTrigger").addClass("current"))}),$("#advancedFiltersMenuTrigger").on("click touchstart",function(e){e.preventDefault(),$("#advancedFiltersMenu").is(":hidden")&&($("#menus, #advancedFiltersMenu").fadeIn("slow"),$("#advancedFiltersMenu").scrollTop(0),psAdvancedFiltersMenu.update())}),$("#menusLeftover, #menusWrapper").on("click touchstart",function(e){!$("#infoMenu").is(":visible")||$(e.target).is("#infoMenu, #infoMenu *")&&!$(e.target).is(".closeButton")||(e.preventDefault(),$("#menus, #infoMenu").fadeOut("slow")),!$("#editMenu").is(":visible")||$(e.target).is("#editMenu, #editMenu *, #infoMenu button.actionButton")&&!$(e.target).is(".closeButton")||(e.preventDefault(),$("#menus, #editMenu").fadeOut("slow")),!$("#advancedFiltersMenu").is(":visible")||$(e.target).is("#advancedFiltersMenu, #advancedFiltersMenu *")&&!$(e.target).is(".closeButton")||(e.preventDefault(),$("#menus, #advancedFiltersMenu").fadeOut("slow")),!$("#configMenu").is(":visible")||$(e.target).is("#configMenu, #configMenu *")&&!$(e.target).is(".closeButton")||(e.preventDefault(),$("#menus, #configMenu").fadeOut("slow"))})}),$(function(){function e(e){var n,t,i='<div id="iconsViewPopulation" class="wrapper">',a='<tbody id="listViewPopulation">',o='<div id="columnsViewPopulation" class="wrapper">';r=new Object;for(var l=0;l<e.length;l++){if(n=s(),i+='<div id="'+n+'" class="printer',a+='<tr id="'+n+'" class="printer',o+='<div id="'+n+'" class="printer',e[l].detailedInfo.status)switch(e[l].detailedInfo.status.toLowerCase()){case"awake":i+=" connected",a+=" connected",o+=" connected",t="Awake";break;case"sleep":i+=" missing",a+=" missing",o+=" missing",t="Sleep";break;case"unreachable":i+=" missing",a+=" missing",o+=" missing",t="Unreachable";break;case"turn off":i+=" missing",a+=" missing",o+=" missing",t="Turn Off";break;case"with alerts":i+=" warning",a+=" warning",o+=" warning",t="With Alerts";break;case"busy with activities":i+=" connected",a+=" connected",o+=" connected",t="Busy With Activities";break;case"with system errors":i+=" error",a+=" error",o+=" error",t="With System Errors";break;case"not initialized":i+=" missing",a+=" missing",o+=" missing",t="Not Initialized";break;default:i+=" missing",a+=" missing",o+=" missing",t="Unknown"}else i+=" missing",a+=" missing",o+=" missing",t="Unknown";i+='" title="'+t+'">',a+='">',o+='" title="'+t+'">',i+='<div class="info">',o+='<div class="info">',e[l].basicInfo.ip?(i+="<p>"+e[l].basicInfo.ip.replace(/\s/g,"&nbsp;")+"</p>",a+="<td>"+e[l].basicInfo.ip+"</td>",o+="<p>"+e[l].basicInfo.ip.replace(/\s/g,"&nbsp;")+"</p>"):(i+="<p>&mdash;</p>",a+="<td>&mdash;</td>"),e[l].basicInfo.modelname?(i+="<p>"+e[l].basicInfo.modelname.replace(/\s/g,"&nbsp;")+"</p>",a+="<td>"+e[l].basicInfo.modelname+"</td>",o+="<p>"+e[l].basicInfo.modelname.replace(/\s/g,"&nbsp;")+"</p>"):(i+="<p>&mdash;</p>",a+="<td>&mdash;</td>"),e[l].detailedInfo.firmwareVersion?(i+="<p>"+e[l].detailedInfo.firmwareVersion.replace(/\s/g,"&nbsp;")+"</p>",a+="<td>"+e[l].detailedInfo.firmwareVersion+"</td>"):(i+="<p>&mdash;</p>",a+="<td>&mdash;</td>"),i+="</div>",o+="</div>",i+='<div class="state">',a+='<td class="state">'+t+"</td>",o+='<div class="state">',null!=e[l].metadata.reservedBy&&null!=e[l].metadata.reservedUntil&&(i+="<p>RESERVED</p>",o+="<p>R</p>"),a+=e[l].metadata.alias?"<td>"+e[l].metadata.alias+"</td>":"<td>&mdash;</td>",a+=e[l].metadata.reservedBy?"<td>"+e[l].metadata.reservedBy+"</td>":"<td>&mdash;</td>",i+="</div></div>",a+="</tr>",o+="</div></div>",r[n]=e[l]}i+="</div>",a+="</tbody>",o+="</div>",$("#iconsViewPopulation").remove(),$("#listViewPopulation").remove(),$("#columnsViewPopulation").remove(),$(i).appendTo("#iconsView"),$(a).appendTo("#listView table.wrapper"),$(o).appendTo("#columnsViewPrintersColumn")}function n(){$("#iconsViewPopulation div.printer, #listViewPopulation tr.printer").off().on("click touchstart",function(e){e.preventDefault();var n=t('<div id="infoMenuDetails" class="wrapper right">',r[e.currentTarget.id]),a=i('<div id="infoMenuInformation" class="wrapper right">',r[e.currentTarget.id].metadata);$("#infoMenuDetails").remove(),$("#infoMenuInformation").remove(),$(n).appendTo("#infoMenuDetailsWrapper"),$(a).appendTo("#infoMenuInformationWrapper"),$("#infoMenu button.actionButton").attr("name",e.currentTarget.id),$("#infoMenu").is(":hidden")&&($("#menus, #infoMenu").fadeIn("slow"),$("#infoMenu").scrollTop(0),psInfoMenu.update())}),$("#columnsViewPopulation div.printer").off().on("click touchstart",function(e){e.preventDefault();var n=t('<div id="columnsViewPrinterDetails" class="wrapper right">',r[e.currentTarget.id]),a=i('<div id="columnsViewPrinterInformation" class="wrapper right">',r[e.currentTarget.id].metadata);$("#columnsViewPrinterDetails").remove(),$("#columnsViewPrinterInformation").remove(),$(n).appendTo("#columnsViewPrinterDetailsWrapper"),$(a).appendTo("#columnsViewPrinterInformationWrapper"),$("#columnsViewPrinterDataColumn button.actionButton").attr("name",e.currentTarget.id),$("#columnsViewPopulation div.current").removeClass("current"),$(e.currentTarget).addClass("current"),$("#columnsViewPrinterDataColumn *").fadeIn("slow"),$("#columnsViewPrinterDataColumn").scrollTop(0),psColumnsViewPrinterDataColumn.update()})}function t(e,n){if(e+=n.basicInfo.hostname?"<p>"+n.basicInfo.hostname.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",e+=n.basicInfo.ip?"<p>"+n.basicInfo.ip.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",e+=n.basicInfo.modelname?"<p>"+n.basicInfo.modelname.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",e+=n.detailedInfo.firmwareVersion?"<p>"+n.detailedInfo.firmwareVersion.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",n.detailedInfo.status){switch(e+='<p class="state',n.detailedInfo.status.toLowerCase()){case"awake":e+=" connected";break;case"sleep":e+=" missing";break;case"unreachable":e+=" missing";break;case"turn off":e+=" missing";break;case"with alerts":e+=" warning";break;case"busy with activities":e+=" connected";break;case"with system errors":e+=" error";break;case"not initialized":e+=" missing";break;default:e+=" missing"}e+='">'+n.detailedInfo.status.replace(/\s/g,"&nbsp;")+"</p>"}else e+='<p class="state missing">Unknown</p>';if(n.creationDate){var t=new Date(n.creationDate);e+="<p>"+("0"+t.getDate()).slice(-2)+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+t.getFullYear()+" "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)+"</p>"}else e+="<p>&mdash;</p>";if(n.lastUpdate.status){var t=new Date(n.lastUpdate.status);e+="<p>"+("0"+t.getDate()).slice(-2)+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+t.getFullYear()+" "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)+"</p>"}else e+="<p>&mdash;</p>";return e+="</div>"}function i(e,n){if(e+=n.alias?"<p>"+n.alias.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",e+=n.location?"<p>"+n.location.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",e+=n.workteam?"<p>"+n.workteam.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",e+=n.reservedBy?"<p>"+n.reservedBy.replace(/\s/g,"&nbsp;")+"</p>":"<p>&mdash;</p>",n.reservedUntil){var t=new Date(n.reservedUntil);e+="<p>"+("0"+t.getDate()).slice(-2)+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+t.getFullYear()+" "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)+"</p>"}else e+="<p>&mdash;</p>";return e+="</div>"}function a(e){if(e.alias?$('#editForm input[name="alias"]').val(e.alias):$('#editForm input[name="alias"]').val(""),e.location?$('#editForm input[name="location"]').val(e.location):$('#editForm input[name="location"]').val(""),e.workteam?$('#editForm input[name="workteam"]').val(e.workteam):$('#editForm input[name="workteam"]').val(""),e.reservedBy?$('#editForm input[name="reservedBy"]').val(e.reservedBy):$('#editForm input[name="reservedBy"]').val(""),e.reservedUntil){var n=new Date(e.reservedUntil);$('#editForm input[name="reservedUntil"]').val(("0"+n.getDate()).slice(-2)+"/"+("0"+(n.getMonth()+1)).slice(-2)+"/"+n.getFullYear()+" "+("0"+n.getHours()).slice(-2)+":"+("0"+n.getMinutes()).slice(-2)+":"+("0"+n.getSeconds()).slice(-2))}else $('#editForm input[name="reservedUntil"]').val("")}function s(){var e,n,t="";for(e=0;e<32;e++)n=16*Math.random()|0,8!=e&&12!=e&&16!=e&&20!=e||(t+="-"),t+=(12==e?4:16==e?3&n|8:n).toString(16);return t}var r,o={controlType:"select",oneLine:!0,timeInput:!0,dateFormat:"dd/mm/yy",timeFormat:"HH:mm:ss"};$.ajax({async:!0,crossDomain:!0,url:"http://"+serverAddress+":"+serverPort+"/printers/list",method:"GET",success:function(t,i){e(t),n()},error:function(e,n,t){t?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}}),$("#infoMenu button.actionButton, #columnsViewPrinterDataColumn button.actionButton").on("click touchstart",function(e){e.preventDefault();var n=t('<div id="editMenuDetails" class="wrapper right">',r[e.currentTarget.name]);$("#editMenuDetails").remove(),$(n).appendTo("#editMenuDetailsWrapper"),a(r[e.currentTarget.name].metadata),$("#editForm input.datetimepicker").datetimepicker(o),$("#editMenu button.actionButton").attr("name",e.currentTarget.name),$("#editMenu").is(":hidden")&&($("#menus").is(":hidden")&&$("#menus").fadeIn("slow"),$("#infoMenu").is(":visible")&&$("#infoMenu").fadeOut(0),$("#editMenu").fadeIn("slow"),$("#editMenu").scrollTop(0),psEditMenu.update())}),$("#editForm").on("submit",function(e){e.preventDefault();var n=$('#editForm input[name="reservedUntil"]').val().replace(/\s\s+/g," ").trim().split(/\/|\s|\:/),t=r[$("#editMenu button.actionButton").attr("name")],a={alias:$('#editForm input[name="alias"]').val().replace(/\s\s+/g," ").trim(),location:$('#editForm input[name="location"]').val().replace(/\s\s+/g," ").trim(),workteam:$('#editForm input[name="workteam"]').val().replace(/\s\s+/g," ").trim(),reservedBy:$('#editForm input[name="reservedBy"]').val().replace(/\s\s+/g," ").trim(),reservedUntil:new Date(n[2],n[1]-1,n[0],n[3],n[4],n[5]).getTime(),calendar:[]};$.ajax({async:!0,crossDomain:!0,url:"http://"+serverAddress+":"+serverPort+"/printers/update?ip="+t.basicInfo.ip+"&hostname="+t.basicInfo.hostname,method:"PUT",headers:{"Content-Type":"application/json"},processData:!1,data:JSON.stringify(a),success:function(e,n){showMessage("Information successfully updated","green"),r[$("#editMenu button.actionButton").attr("name")].metadata=a,$("#editMenu button.actionButton").attr("name")==$("#columnsViewPrinterDataColumn button.actionButton").attr("name")&&($("#columnsViewPrinterInformation").remove(),$(i('<div id="columnsViewPrinterInformation" class="wrapper right">',a)).appendTo("#columnsViewPrinterInformationWrapper"),$("#columnsViewPrinterDataColumn *").fadeIn("slow")),$("#menus, #editMenu").fadeOut("slow")},error:function(e,n,t){t?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}})})}),$(function(){$("#configMenuTrigger").on("click touchstart",function(e){e.preventDefault(),$("#configMenu").is(":hidden")&&$.ajax({async:!0,crossDomain:!0,url:"http://"+serverAddress+":"+serverPort+"/config/data",method:"GET",success:function(e,n){e.logLevel?$('#configForm input[name="logLevel"]').val(e.logLevel):$('#configForm input[name="logLevel"]').val(""),e.logSeparator?$('#configForm input[name="logSeparator"]').val(e.logSeparator):$('#configForm input[name="logSeparator"]').val(""),e.updateFrequency?$('#configForm input[name="updateFrequency"]').val(e.updateFrequency/1e3):$('#configForm input[name="updateFrequency"]').val(""),e.deleteTimeout?$('#configForm input[name="deleteTimeout"]').val(e.deleteTimeout/6e4):$('#configForm input[name="deleteTimeout"]').val(""),$("#menus, #configMenu").fadeIn("slow"),$("#configMenu").scrollTop(0),psConfigMenu.update()},error:function(e,n,t){t?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}})}),$("#configForm").on("submit",function(e){e.preventDefault(),$.ajax({async:!0,crossDomain:!0,url:"http://"+serverAddress+":"+serverPort+"/config/update",method:"PUT",headers:{"Content-Type":"application/json"},processData:!1,data:JSON.stringify({logLevel:parseInt($('#configForm input[name="logLevel"]').val()),logSeparator:parseInt($('#configForm input[name="logSeparator"]').val()),updateFrequency:1e3*parseInt($('#configForm input[name="updateFrequency"]').val()),deleteTimeout:6e4*parseInt($('#configForm input[name="deleteTimeout"]').val())}),success:function(e,n){showMessage("Configuration successfully updated","green"),$("#menus, #configMenu").fadeOut("slow")},error:function(e,n,t){t?showMessage(e.responseText,"red"):showMessage("Unable to connect to server","red")}})})});